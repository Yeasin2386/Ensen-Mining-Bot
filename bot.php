<?php

// ржЖржкржирж╛рж░ ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржмржЯ API ржЯрзЛржХрзЗржи
// **ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг: 'YOUR_BOT_TOKEN' ржПрж░ ржмржжрж▓рзЗ ржЖржкржирж╛рж░ ржЖрж╕рж▓ ржЯрзЛржХрзЗржиржЯрж┐ ржмрж╕рж╛ржиред**
define('BOT_TOKEN', 'YOUR_BOT_TOKEN'); 

// ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо API ржПрж░ ржмрзЗрж╕ URL
define('API_URL', 'https://api.telegram.org/bot' . BOT_TOKEN . '/');

// ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржерзЗржХрзЗ ржкрж╛ржарж╛ржирзЛ ржЖржкржбрзЗржЯ ржбрзЗржЯрж╛ ржЧрзНрж░рж╣ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
$update = json_decode(file_get_contents('php://input'), true);

// ржпржжрж┐ ржкрзНрж░рж╛ржкрзНржд ржЖржкржбрзЗржЯрзЗ ржХрзЛржирзЛ ржорзЗрж╕рзЗржЬ ржерж╛ржХрзЗ
if (isset($update['message'])) {
    $message = $update['message'];
    $chat_id = $message['chat']['id']; // ржорзЗрж╕рзЗржЬ ржпрзЗ ржЪрзНржпрж╛ржЯ ржерзЗржХрзЗ ржПрж╕рзЗржЫрзЗ рждрж╛рж░ ржЖржЗржбрж┐
    $text = $message['text'];           // ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрж╛ржарж╛ржирзЛ ржорзЗрж╕рзЗржЬ

    // рж▓рзЛржЧрж┐ржВ ржПрж░ ржЬржирзНржп (ржмржЯ ржЪрж╛рж▓рзБ ржЖржЫрзЗ ржХрж┐ржирж╛ ржмрзБржЭрждрзЗ)
    // ржПржЯрж┐ Render ржПрж░ рж▓ржЧрж╕рзЗ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ
    error_log("Received message from chat ID: " . $chat_id . " - Text: " . $text);

    // ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржорзЗрж╕рзЗржЬрзЗрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ ржмрж┐ржнрж┐ржирзНржи ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛
    switch ($text) {
        case '/start':
            // ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА /start ржХржорж╛ржирзНржб ржкрж╛ржарж╛ржмрзЗ
            $response_text = "рж╕рзНржмрж╛ржЧрждржо! ЁЯСЛ ржЖржорж┐ ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг ржЯрзЗрж╕рзНржЯрж┐ржВ ржмржЯред ржЖржорж┐ ржПржЦржи ржЕржирж▓рж╛ржЗржирзЗ ржЖржЫрж┐ ржПржмржВ ржХрж╛ржЬ ржХрж░ржЫрж┐ред ржЖржкржирж┐ /hello рж▓рж┐ржЦрзЗ ржжрзЗржЦрждрзЗ ржкрж╛рж░рзЗржиред";
            sendMessage($chat_id, $response_text);
            break;
        case '/hello':
            // ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА /hello ржХржорж╛ржирзНржб ржкрж╛ржарж╛ржмрзЗ
            $response_text = "рж╣рзНржпрж╛рж▓рзЛ! ЁЯШК ржЖржорж┐ ржарж┐ржХржарж╛ржХ ржХрж╛ржЬ ржХрж░ржЫрж┐ред ржЖржкржирж┐ ржпрж╛ рж▓рж┐ржЦрзЗржЫрзЗржи рждрж╛ рж╣рж▓рзЛ: '" . $text . "'ред";
            sendMessage($chat_id, $response_text);
            break;
        default:
            // ржЕржирзНржп ржпрзЗржХрзЛржирзЛ ржорзЗрж╕рзЗржЬрзЗрж░ ржЬржирзНржп ржбрж┐ржлрж▓рзНржЯ ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛
            $response_text = "ржЖржкржирж┐ ржмрж▓рзЗржЫрзЗржи: '" . $text . "'ред ржЖржорж┐ ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржмрзБржЭрж┐ ржирж╛ред рждржмрзЗ, ржЖржорж┐ ржПржЦржиржУ ржЕржирж▓рж╛ржЗржи ржЖржЫрж┐ ржПржмржВ ржЖржкржирж╛рж░ ржорзЗрж╕рзЗржЬ ржкрж╛ржЪрзНржЫрж┐! ЁЯОЙ";
            sendMessage($chat_id, $response_text);
            break;
    }
}

/**
 * ржПржЗ ржлрж╛ржВрж╢ржиржЯрж┐ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЪрзНржпрж╛ржЯ ржЖржЗржбрж┐рждрзЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣ржпрж╝ред
 * @param int $chat_id ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛрж░ ржЬржирзНржп ржЪрзНржпрж╛ржЯ ржЖржЗржбрж┐ред
 * @param string $text ржпрзЗ ржорзЗрж╕рзЗржЬржЯрж┐ ржкрж╛ржарж╛рждрзЗ рж╣ржмрзЗред
 */
function sendMessage($chat_id, $text) {
    $parameters = array(
        'chat_id' => $chat_id,
        'text' => $text,
        'parse_mode' => 'HTML' // HTML ржЯрзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝
    );
    
    $url = API_URL . 'sendMessage?' . http_build_query($parameters);
    
    // cURL ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ HTTP GET рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗред
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 
    $response = curl_exec($ch);
    curl_close($ch);
    
    // ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛрж░ ржкрж░ рж▓рзЛржЧрж┐ржВ (ржбрж┐ржмрж╛ржЧрж┐ржВ ржПрж░ ржЬржирзНржп)
    error_log("Sent message to chat ID: " . $chat_id . " - Text: " . $text);
    
    return $response; 
}

?>